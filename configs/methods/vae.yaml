evaluator:
  devices: ["cuda:1", "cuda:2"]
  topk: 1
  temperature: 1.
  metrics:
    - Reconstruction


# MODEL
model:
  name: VAE
  autoencoder:
    name: VAE
    params:
      use_time: True
      num_layers: 7
      d_token: 6
      n_head: 2
      factor: 64
    pretrain: True
    frozen: False
    checkpoint:
    batch_transforms:
  latent_encoder:

optimizer:
  name: Adam
  params:
    lr: 1.5e-3
    weight_decay: 1.e-3

schedulers:
  "step":
    StepLR:
      step_size: 30
  "beta":
    BetaScheduler:
      init_beta: 0.01
      factor: 0.7
      patience: 4
      min_beta: 0.00001
      verbose: True

loss:
  name: VAELoss


optuna:
  params:
    n_trials: 100
    n_startup_trials: 10
    request_list: []
    target_metric: ${trainer.ckpt_track_metric}
  suggestions:
    - ["optimizer.params.weight_decay", ["suggest_float", {low: 1.e-15, high: 1.e-2, log: True}]]
    - ["optimizer.params.lr", ["suggest_float", {low: 1.e-5, high: 0.1, log: True}]]

    - ["model.autoencoder.params.d_token", ["suggest_int", {"low": 8, "high": 128, "step": 8}]]
    - ["model.autoencoder.params.num_layers", ["suggest_int", {"low": 1, "high": 10, "log": false}]]
    - ["model.autoencoder.params.n_head", ["suggest_categorical", {"choices": [1,2,4,8]}]]
    - ["model.autoencoder.params.factor", ["suggest_int", {"low": 1, "high": 512, "log": true}]]

    - 
      - ["data_conf.train_transforms.1.TimeToDiff.disable", "data_conf.val_transforms.1.TimeToDiff.disable"]
      - ["suggest_categorical", {choices: [True, False]}]

    - ["schedulers.step.StepLR.step_size", ["suggest_int", {"low": 10, "high": 50, "step": 10, "log": false}]]
    - ["schedulers.beta.BetaScheduler.init_beta", ["suggest_float", {"low": 0.001, "high": 1, "log": true}]]
    - ["schedulers.beta.BetaScheduler.factor", ["suggest_float", {"low": 0.1, "high": 0.9, "step": 0.1}]]
    - ["schedulers.beta.BetaScheduler.patience", ["suggest_int", {"low": 2, "high": 10}]]